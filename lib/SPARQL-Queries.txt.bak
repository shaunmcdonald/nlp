GET ALL CONCEPTS WITH NO SIBLINGS
PREFIX skos:<http://www.w3.org/2004/02/skos/core#>
SELECT ?narrower ?narLabel
WHERE {
	?concept skos:narrower ?narrower.
	?narrower skos:prefLabel ?narLabel.
	{
		SELECT ?concept ?label (count(distinct ?narrower) as ?count)
		WHERE {
		 ?concept a skos:Concept;
		   skos:broader ?broader;
		   skos:narrower ?narrower;
		   skos:prefLabel ?label.
		}
		GROUP BY ?concept ?label
		HAVING (?count = 1)
	}
}

PREFIX skos:<http://www.w3.org/2004/02/skos/core#>
SELECT ?concept ?label
WHERE {
 ?concept a skos:Concept;
   skos:broader ?broader;
   skos:prefLabel ?label.

	FILTER regex(?label, "history", "i")
	FILTER NOT EXISTS {
     ?concept skos:broader+ <http://data.oup.com/taxonomy/AcademicSubjects/AHU00830>.
  }
}

GET ALL SKOS RELATIONS FOR A TAXONOMY
PREFIX skos:<http://www.w3.org/2004/02/skos/core#>
PREFIX rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX dct:<http://purl.org/dc/terms/>
select ?uri ?label ?altLabel ?skosRelation ?otCode
where {
  {?uri rdf:type skos:ConceptScheme;
   dct:title ?label.}
  UNION
  {VALUES ?skosRelation {
   skos:closeMatch
   skos:exactMatch
   skos:relatedMatch
   skos:narrowMatch
   skos:broadMatch
   skos:related
  }
  ?uri ?skosRelation ?otCode;
  skos:prefLabel ?label.
  OPTIONAL { ?uri  skos:altLabel  ?altLabel. }}
}
*************************************************************************************
PP ADMIN TASKS
#######################################################################################
DESCRIBE A USER

DESCRIBE <http://atticusdata01.uk.oup.com/user/user/knowlesm>

DELETE DUPLICATE USER DATA

DELETE
{ <http://atticusdata01.uk.oup.com/user/user/knowlesm> <http://schema.semantic-web.at/users/password> ?o }

WHERE

{SELECT ?o
{ <http://atticusdata01.uk.oup.com/user/user/knowlesm> <http://schema.semantic-web.at/users/password> ?o . }
LIMIT 1
}
#######################################################################################
CLEAR DEPRECATED GRAPH (THIS ONE IS BJS)
CLEAR GRAPH <http://data.oup.com/taxonomy/(bjs)/thesaurus/deprecated>

CHECK THE GRAPH
SELECT *
FROM <http://data.oup.com/taxonomy/bjs/thesaurus/deprecated>
WHERE {?s ?p ?o}
#######################################################################################
CASTING TO xsd:date doesn't work, use STRDT(value, xsd:date)

SELECT ?uri ?isbn ?eisbn ?pCode ?otCode ?pDate
WHERE {
 ?uri oup:hasTaxonomyCode ?otCode;
  rdf:type oup:Record;
  oup:hasISBN ?isbn;
  oup:hasProductCode ?pCode;
  oup:hasPubDate ?pDate.
  OPTIONAL{?uri oup:hasEISBN ?eisbn}
  FILTER NOT EXISTS {
     ?uri oup:hasProductCode "OSO".
  }
  FILTER (STRDT(?pDate,xsd:date) > STRDT("2007-12-31",xsd:date))
}
***************************************************************************************************************************************

DESCRIBE <https://schema.oup.com/OUPCommonStructureModel/CognitiveDemandIndicator>
GET THE OUP COMMON STRUCTURE ONTOLOGY

PREFIX skos:<http://www.w3.org/2004/02/skos/core#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf4j: <http://rdf4j.org/schema/rdf4j#>
PREFIX sesame: <http://www.openrdf.org/schema/sesame#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX fn: <http://www.w3.org/2005/xpath-functions#>
SELECT ?uri ?label
WHERE {
    { 
    	<https://schema.oup.com/OUPCommonStructureModel> <http://schema.semantic-web.at/ppt/containsCustomType> ?uri.
    	?uri rdfs:label ?label.
    }
    UNION
    { 
    	<https://schema.oup.com/OUPCommonStructureModel> <http://schema.semantic-web.at/ppt/containsAttributeProperty> ?uri.
    	?uri rdfs:label ?label.
    }
    UNION
    { 
    	<https://schema.oup.com/OUPCommonStructureModel> <http://schema.semantic-web.at/ppt/containsPropertyWithInverse> ?uri.
    	?uri rdfs:label ?label.
    }
}

GET OUP COMMON STRUCTURE EXPORT
PREFIX skos:<http://www.w3.org/2004/02/skos/core#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf4j: <http://rdf4j.org/schema/rdf4j#>
PREFIX sesame: <http://www.openrdf.org/schema/sesame#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX fn: <http://www.w3.org/2005/xpath-functions#>
PREFIX oupcs: <https://schema.oup.com/OUPCommonStructureModel/>

SELECT *
WHERE {
	{?uri rdf:type http://www.w3.org/2004/02/skos/core#ConceptScheme;
	  DCTERMS:title ?o}
	UNION
	{?uri <http://schema.semantic-web.at/ppt/appliedType> oupcs:ConceptStatement ;
	 ?s ?o.}
} 

##############################################################
Prefixes
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX dc-term:<http://purl.org/dc/terms/>
PREFIX rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX dc:<http://purl.org/dc/elements/1.1/>
PREFIX foaf:<http://xmlns.com/foaf/0.1/>
PREFIX xsd:<http://www.w3.org/2001/XMLSchema#>
PREFIX owl:<http://www.w3.org/2002/07/owl#>
PREFIX oup:<http://oxfordindex.oup.com/metadata/>

Delete DNB-WW Same Entity

DELETE {
	<http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/33168~sameEntityAs~10.1093/ww/9780199540884.013.U172471> ?pred1 ?obj1. 
	?obj2 ?pred2 <http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/33168~sameEntityAs~10.1093/ww/9780199540884.013.U172471>.
	
	<http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/75967~sameEntityAs~10.1093/ww/9780199540884.013.U7546> ?pred3 ?obj3. 
	?obj4 ?pred4 <http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/75967~sameEntityAs~10.1093/ww/9780199540884.013.U7546>.}
WHERE
{
	<http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/33168~sameEntityAs~10.1093/ww/9780199540884.013.U172471> a oup:sameEntityAsLink;
		?pred1 ?obj1.
	?obj2 ?pred2 <http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/33168~sameEntityAs~10.1093/ww/9780199540884.013.U172471>.
	
	<http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/75967~sameEntityAs~10.1093/ww/9780199540884.013.U7546> a oup:sameEntityAsLink;
		?pred3 ?obj3.
	?obj4 ?pred4 <http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/75967~sameEntityAs~10.1093/ww/9780199540884.013.U7546>.
}

GET PP CONCEPTS WITH LITERALS THAT HAVE NO LANG TAG
SELECT ?x ?lab ?lit
WHERE
{
  ?x a skos:Concept;
  skos:prefLabel ?lab;
  <http://data.oup.com/taxonomy/oupContentSetMappings/bic> ?lit.
  filter (lang(?lit) = "")

}

WITH <http://data.oup.com/taxonomy/AcademicSubjects/thesaurus> 
DELETE { ?x <http://data.oup.com/taxonomy/oupContentSetMappings/bic> ?lit. } 
INSERT { ?x <http://data.oup.com/taxonomy/oupContentSetMappings/bic> ?lit. } WHERE { ... }

Stock SPARQL Queries
SELECT ?uri ?subject
WHERE {
 {
  ?uri oup:hasISBN "9780190051105";
   rdf:type oup:Record;
   oup:hasTaxonomyCode ?subject.
 } UNION 
 {
  ?uri oup:hasEISBN "9780190051105";
   rdf:type oup:Record;
   oup:hasTaxonomyCode ?subject
 }
}

SELECT ?doi
WHERE{
  ?doi a oup:Record;
    oup:hasISBN ?eisbn1.
  FILTER regex(str(?eisbn1), "9780190051105")
}

SELECT ?doi ?isbn1 ?eisbn1 ?pcode (group_concat(?subject) as ?subjects) ?link
WHERE {
 {
  ?link a oup:replacesLink;
    oup:hasTarget ?doi.
  ?doi oup:hasProductCode ?pcode;
    oup:hasTaxonomyCode ?subject.
  OPTIONAL{
    ?doi oup:hasISBN ?isbn1;
    oup:hasEISBN ?eisbn1.}
 }
 UNION
 {
  ?link a oup:replacesLink.
  ?doi oup:hasLink ?link;
    oup:hasProductCode ?pcode;
    oup:hasTaxonomyCode ?subject.
  OPTIONAL{
    ?doi oup:hasISBN ?isbn1;
    oup:hasEISBN ?eisbn1.}
 }
}GROUP BY ?doi ?isbn1 ?eisbn1 ?pcode ?link

SELECT ?doi ?isbn1 ?eisbn1 ?pcode (group_concat(?subject) as ?subjects) ?link
WHERE{
  ?link a oup:replacesLink.
  FILTER ( EXISTS{?doi oup:hasLink ?link} || EXISTS{?link oup:hasTarget ?doi}
  )
}
GROUP BY ?doi ?isbn1 ?eisbn1 ?pcode ?title ?link

SELECT ?doi ?isbn1 ?eisbn1 ?pcode (group_concat(?subject) as ?subjects) ?link
WHERE{
  ?doi a oup:Record;
    oup:hasISBN ?isbn1;
    oup:hasEISBN ?eisbn1;
    oup:hasProductCode ?pcode;
    oup:hasTaxonomyCode ?subject;
    oup:hasLink ?link.
  ?link a oup:replacesLink;
    oup:hasTarget ?replaced.
  ?replaced oup:hasISBN ?isbn2;
  oup:hasEISBN ?eisbn2.
}
GROUP BY ?doi ?isbn1 ?eisbn1 ?pcode ?link ?isbn2 ?eisbn2

SELECT ?uri ?isbn ?eisbn ?otCode
WHERE {
 ?uri oup:hasTaxonomyCode ?otCode;
   oup:hasISBN|oup:hasISBN ?directFilter.
 {?uri oup:hasISBN ?isbn} UNION {?uri oup:hasEISBN ?eisbn}
} LIMIT 100

SELECT (COUNT(DISTINCT ?uri) as ?count)
WHERE {
 ?uri oup:hasTaxonomyCode ?otCode;
   oup:hasISBN|oup:hasISBN ?directFilter.
}

Get Auto-Approved Links (approved by Accuracy)
SELECT (COUNT(DISTINCT ?link) as ?count)
WHERE{
 ?link a oup:isPrimaryTopicOfLink;
  oup:hasMatchStatus "approved";
  oup:hasAccuracy ?acc.
 FILTER regex(str(?link), "benz")
 FILTER (xsd:integer(?acc) >= 50)
}
Get New SameEntityAs Records by Product Pair via Regex
ALL
SELECT DISTINCT ?record1 ?record2
WHERE{
  ?auth a oup:Authority;
    oup:hasLink ?plink1;
    oup:hasLink ?plink2.
  ?plink1 a oup:isPrimaryTopicOfLink.
  ?plink2 a oup:isPrimaryTopicOfLink.
  FILTER (?plink1 != ?plink2)
  FILTER regex(str(?plink1), "10\\.1093\\/benz")
  FILTER regex(str(?plink2), "10\\.1093\\/www?")
  ?plink1 oup:hasTarget ?record1.
  ?plink2 oup:hasTarget ?record2.
  FILTER NOT EXISTS {
    ?record1 oup:hasLink/rdf:type oup:sameEntityAsLink.
    ?record2 oup:hasLink/rdf:type oup:sameEntityAsLink.
    ?record1 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
    ?record2 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
  }
}
Approved
SELECT DISTINCT ?record1 ?record2
WHERE{
  ?auth a oup:Authority;
    oup:hasLink ?plink1;
    oup:hasLink ?plink2.
  ?plink1 a oup:isPrimaryTopicOfLink;
     oup:hasMatchStatus “approved”.
  ?plink2 a oup:isPrimaryTopicOfLink;
     oup:hasMatchStatus “approved”.
  FILTER (?plink1 != ?plink2)
  FILTER regex(str(?plink1), "10\\.1093\\/benz")
  FILTER regex(str(?plink2), "10\\.1093\\/www?")
  ?plink1 oup:hasTarget ?record1.
  ?plink2 oup:hasTarget ?record2.
  FILTER NOT EXISTS {
    ?record1 oup:hasLink/rdf:type oup:sameEntityAsLink.
    ?record2 oup:hasLink/rdf:type oup:sameEntityAsLink.
    ?record1 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
    ?record2 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
  }
}

Get New SameEntityAs Records by Product Pair via ProductCode
ALL
LongForm All
SELECT DISTINCT ?record1 ?record2
WHERE{
  ?auth a oup:Authority;
    oup:hasLink ?plink1;
    oup:hasLink ?plink2.
  ?plink1 a oup:isPrimaryTopicOfLink.
  ?plink2 a oup:isPrimaryTopicOfLink.
  FILTER (!sameTerm(?plink1, ?plink2))
  ?plink1 oup:hasTarget ?record1.
  ?record1 oup:hasProductCode "ANB ".
  ?plink2 oup:hasTarget ?record2.
  ?record2 oup:hasProductCode "OAO ".
  FILTER NOT EXISTS {
    ?record1 oup:hasLink ?sameLink1.
    ?sameLink1 a oup:sameEntityAsLink;
       oup:hasTarget ?record2.
        ?record2 oup:hasLink ?sameLink2.
    ?sameLink2 a oup:sameEntityAsLink;
       oup:hasTarget ?record1.
  }
}
Approved
Longform Approved
SELECT DISTINCT ?record1 ?record2
WHERE{
  ?auth a oup:Authority;
    oup:hasLink ?plink1;
    oup:hasLink ?plink2.
  ?plink1 a oup:isPrimaryTopicOfLink;
          oup:hasMatchStatus "approved ".
  ?plink2 a oup:isPrimaryTopicOfLink;
          oup:hasMatchStatus "approved ".
  FILTER (!sameTerm(?plink1, ?plink2))
  ?plink1 oup:hasTarget ?record1.
  ?record1 oup:hasProductCode "ANB ".
  ?plink2 oup:hasTarget ?record2.
  ?record2 oup:hasProductCode "OAO ".
  FILTER NOT EXISTS {
    ?record1 oup:hasLink ?sameLink1.
    ?sameLink1 a oup:sameEntityAsLink;
       oup:hasTarget ?record2.
        ?record2 oup:hasLink ?sameLink2.
    ?sameLink2 a oup:sameEntityAsLink;
       oup:hasTarget ?record1.
  }
}

Get New SameEntityAs Records

SELECT DISTINCT ?record1 ?record2
WHERE{
  ?auth a oup:Authority;
    oup:hasLink ?plink1;
    oup:hasLink ?plink2.
  ?plink1 a oup:isPrimaryTopicOfLink.
  ?plink2 a oup:isPrimaryTopicOfLink.
  FILTER (!sameTerm(?plink1, ?plink2))
  ?plink1 oup:hasTarget ?record1.
  ?plink2 oup:hasTarget ?record2.
  FILTER NOT EXISTS {
    ?record1 oup:hasLink/rdf:type oup:sameEntityAsLink.
    ?record2 oup:hasLink/rdf:type oup:sameEntityAsLink.
    ?record1 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
    ?record2 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
  }
}

Linux Direct Version
SELECT DISTINCT ?auth ?record1 ?record2
WHERE{
  ?auth a oup:Authority;
    oup:hasLink ?plink1;
    oup:hasLink ?plink2.
  ?plink1 a oup:isPrimaryTopicOfLink;
    oup:hasMatchStatus "approved".
  ?plink2 a oup:isPrimaryTopicOfLink;
    oup:hasMatchStatus "approved".
  FILTER (!sameTerm(?plink1, ?plink2))
  ?plink1 oup:hasTarget ?record1.
  ?plink2 oup:hasTarget ?record2.
  FILTER NOT EXISTS {
    ?record1 oup:hasLink ?same1.
    ?same1 a oup:sameEntityAsLink;
      oup:hasTarget ?record2.
    ?record2 oup:hasLink ?same2.
    ?same2 a oup:sameEntityAsLink;
      oup:hasTarget ?record1.
  }
}

PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT DISTINCT ?auth ?record1 ?record2 WHERE{?auth a oup:Authority; oup:hasLink ?plink1; oup:hasLink ?plink2. ?plink1 a oup:isPrimaryTopicOfLink; oup:hasMatchStatus "approved". ?plink2 a oup:isPrimaryTopicOfLink; oup:hasMatchStatus "approved". FILTER (!sameTerm(?plink1, ?plink2)) ?plink1 oup:hasTarget ?record1. ?plink2 oup:hasTarget ?record2. FILTER NOT EXISTS {?record1 oup:hasLink ?same1. ?same1 a oup:sameEntityAsLink; oup:hasTarget ?record2. ?record2 oup:hasLink ?same2. ?same2 a oup:sameEntityAsLink; oup:hasTarget ?record1.}}.
Get Count of the same
SELECT (COUNT(DISTINCT *) AS ?count){
  SELECT DISTINCT ?record1 ?record2
  WHERE{
    ?auth a oup:Authority;
      oup:hasLink ?plink1;
      oup:hasLink ?plink2.
    ?plink1 a oup:isPrimaryTopicOfLink.
    ?plink2 a oup:isPrimaryTopicOfLink.
    FILTER (!sameTerm(?plink1, ?plink2))
    ?plink1 oup:hasTarget ?record1.
    ?plink2 oup:hasTarget ?record2.
    FILTER NOT EXISTS {
      ?record1 oup:hasLink/rdf:type oup:sameEntityAsLink.
      ?record2 oup:hasLink/rdf:type oup:sameEntityAsLink.
      ?record1 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
      ?record2 ^oup:hasTarget/rdf:type oup:sameEntityAsLink.
    }
  }
}
Get Existing SameEntityAs Links
Longform Approved
SELECT DISTINCT ?same1
WHERE{
  ?record1 a oup:Record;
    oup:hasProductCode "ANB";
    oup:hasLink ?same1.
  ?same1 a oup:sameEntityAsLink;
    oup:hasMatchStatus "approved";
    oup:hasTarget ?record2.
  ?record2 oup:hasProductCode "OAO".
}
GET SAME ENTITY AS BY DISTINCT PRODUCT
SELECT DISTINCT ?prodSource ?prodTarg
WHERE {
 ?same a oup:sameEntityAsLink;
  oup:hasTarget ?recTarg.
 ?recTarg oup:hasProductCode ?prodTarg.
 ?recSource oup:hasLink ?same.
  ?recSource oup:hasProductCode ?prodSource.
}
DELETE SELF LINKING SAME ENTITY AS
DELETE{
 ?same rdf:type oup:sameEntityAsLink.
 ?same oup:hasTarget ?recTarget.
 ?recSource oup:hasLink ?same.
}
WHERE{
 ?same a oup:sameEntityAsLink;
  oup:hasTarget ?recTarget.
 ?recSource oup:hasLink ?same.
 FILTER ( ?recSource = ?recTarget)
}
Create Same Entity As
MAKE SURE TO CHECK THE “FILTER NOT EXIST” PART GOING BOTH WAYS!!!!!
This SPARQL only checks to make sure no sameAs link already exists from Source to Target, but a second query is needed to check from Target to Source because today 2016-08-25 I discovered Atticus is reciprocating sameAs links dynamically, despite that we were told it doesn’t.
TEST
SELECT ?same ?recSource ?recTarget
WHERE{
 ?auth a oup:Authority;
  oup:hasLink ?plink1;
  oup:hasLink ?plink2.
 ?plink1 a oup:isPrimaryTopicOfLink;
  oup:hasMatchStatus "approved".
 ?plink2 a oup:isPrimaryTopicOfLink;
  oup:hasMatchStatus "approved".
 FILTER (!sameTerm(?plink1, ?plink2))
 ?plink1 oup:hasTarget ?recSource.
 ?recSource oup:hasProductCode "ANB".
 ?plink2 oup:hasTarget ?recTarget.
 ?recTarget oup:hasProductCode "OAO".
 FILTER NOT EXISTS {
  ?recSource oup:hasLink ?sameLink1.
  ?sameLink1 a oup:sameEntityAsLink;
   oup:hasTarget ?recTarget.
  }
 BIND(IRI(CONCAT(STR(?recSource), "~sameEntityAs~",SUBSTR(STR(?recTarget),37)))
AS ?same)
}

Links between GAO and Benezit
They don’t appear to be approved yet.

SELECT ?same ?recSource ?recTarget
WHERE{
 ?auth a oup:Authority;
  oup:hasLink ?plink1;
  oup:hasLink ?plink2.
 ?plink1 a oup:isPrimaryTopicOfLink.

 ?plink2 a oup:isPrimaryTopicOfLink.

 FILTER (!sameTerm(?plink1, ?plink2))
 ?plink1 oup:hasTarget ?recSource.
 ?recSource oup:hasProductCode "OAO".
 FILTER regex(str(?recSource) , "gao")
 ?plink2 oup:hasTarget ?recTarget.
 ?recTarget oup:hasProductCode "OAO".
 FILTER regex(str(?recTarget) , "benz")
 FILTER NOT EXISTS {
  ?recSource oup:hasLink ?sameLink1.
  ?sameLink1 a oup:sameEntityAsLink;
   oup:hasTarget ?recTarget.
  }
 BIND(IRI(CONCAT(STR(?recSource), "~sameEntityAs~",SUBSTR(STR(?recTarget),37)))
AS ?same)
}
UPDATE
INSERT{
 ?same rdf:type oup:sameEntityAsLink.
 ?same oup:hasTarget ?target.
 ?same oup:hasProvenanceOrigin "mcdonalds".
 ?same oup:hasProvenanceDate "2017-02-01T00:00:00.000".
 ?source oup:hasLink ?same.
}
WHERE{
 ?link a oup:isPrimaryTopicOfLink;
   oup:hasAccuracy ?acc;
   oup:hasTarget ?source.
 FILTER (regex(str(?link), "benz"))
 FILTER (xsd:integer(?acc) > 29)
 ?link2 a oup:isPrimaryTopicOfLink;
   oup:hasTarget ?target.
 FILTER (regex(str(?link2), "gao"))
 ?auth oup:hasLink ?link;
   oup:hasLink ?link2.
 BIND(IRI(CONCAT(STR(?source), "~sameEntityAs~",SUBSTR(STR(?target),37))) AS ?same)
}

Get ODNB Links To Groves
SELECT ?record1
WHERE {
 {
  ?record1 a oup:Record.
  ?record1 oup:hasProductCode "ODNB".
  ?record1 oup:hasLink ?link1.
  ?link1 a oup:sameEntityAsLink.
  ?link1 oup:hasTarget ?record2.
  ?record2 oup:hasProductCode "OMO".
 }
 UNION
  {
  ?record1 a oup:Record.
  ?record1 oup:hasProductCode "ODNB".
  ?record1 oup:hasLink ?link1.
  ?link1 a oup:sameEntityAsLink.
  ?link1 oup:hasTarget ?record2.
  ?record2 oup:hasProductCode "OAO".
 }
}


##### APPROVE LINKS
Get Counts by productCode in link ID

SELECT (count(distinct ?link) as ?linkCount)
WHERE{
 ?link a oup:isPrimaryTopicOfLink;
         oup:hasMatchStatus "waiting".
 FILTER regex(str(?link), "gao")
}

Same count but >=50 accuracy

SELECT (count(distinct ?link) as ?linkCount)
WHERE{
 ?link a oup:isPrimaryTopicOfLink;
         oup:hasAccuracy ?acc;
         oup:hasMatchStatus "waiting".
 FILTER regex(str(?link), "gmo")
 FILTER (xsd:decimal(?acc) >= 49)
}

UPDATE

DELETE {?link oup:hasMatchStatus "waiting".}
INSERT {?link oup:hasMatchStatus "approved".}
WHERE{
 ?link a oup:isPrimaryTopicOfLink;
         oup:hasAccuracy ?acc;
         oup:hasMatchStatus "waiting".
 FILTER regex(str(?link), "gmo")
 FILTER (xsd:decimal(?acc) >= 49)
}


####

GET AUTHORITIES WITH NO PRIMARY AND AUTHOR LINKS
SELECT ?auth
WHERE
{
  ?auth a oup:Authority.
  FILTER NOT EXISTS
    {
      ?auth oup:hasLink ?link1.
      ?link1 a oup:isPrimaryTopicOfLink.
    }
  FILTER NOT EXISTS
    {
      ?auth oup:hasLink ?link2.
      ?link2 a oup:isAuthorOfLink.
    }
}

OPENRDF VERSION
PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT ?auth WHERE {?auth a oup:Authority. FILTER NOT EXISTS {?auth oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink.} FILTER NOT EXISTS {?auth oup:hasLink ?link2. ?link2 a oup:isAuthorOfLink.}}


SELECT (count(DISTINCT ?auth) as ?countauth)
WHERE
{
  ?auth a oup:Authority.
  FILTER NOT EXISTS
    {
      ?auth oup:hasLink ?link1.
      ?link1 a oup:isPrimaryTopicOfLink.
    }
  FILTER NOT EXISTS
    {
      ?auth oup:hasLink ?link2.
      ?link2 a oup:isAuthorOfLink.
    }
}ORDER BY ?auth

PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT (count(DISTINCT ?auth) as ?countauth) WHERE {?auth a oup:Authority. FILTER NOT EXISTS {?auth oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink.} FILTER NOT EXISTS {?auth oup:hasLink ?link2. ?link2 a oup:isAuthorOfLink.}}ORDER BY ?auth

DELETE AUTHS WITH NO PRIMARY AND AUTHOR LINKS

DELETE {?auth ?pred1 ?obj1. ?link ?pred2 ?auth.}
WHERE
{
	?auth a oup:Authority;
	    ?pred1 ?obj1.
	?link ?pred2 ?auth.
	{
		SELECT ?auth
		WHERE
		{
		  ?auth a oup:Authority.
		  FILTER NOT EXISTS
			{
			  ?auth oup:hasLink ?link1.
			  ?link1 a oup:isPrimaryTopicOfLink.
			}
		  FILTER NOT EXISTS
			{
			  ?auth oup:hasLink ?link2.
			  ?link2 a oup:isAuthorOfLink.
			}
		}
	}
}

OPENRDF VERSION
PREFIX oup:<http://oxfordindex.oup.com/metadata/> DELETE {?auth ?pred1 ?obj1. ?link ?pred2 ?auth.} WHERE {?auth a oup:Authority; ?pred1 ?obj1. ?link ?pred2 ?auth. {SELECT ?auth WHERE{?auth a oup:Authority. FILTER NOT EXISTS {?auth oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink.} FILTER NOT EXISTS {?auth oup:hasLink ?link2. ?link2 a oup:isAuthorOfLink.}}}}


DELETE ALL WAITING LINKS

DELETE {?subj ?pred1 ?link. ?link ?pred2 ?obj.}
WHERE
{
	?link a oup:isPrimaryTopicOfLink;
		oup:hasMatchStatus 'waiting';
		?pred2 ?obj.
	?subj ?pred1 ?link.
}

OPENRDF CONSOLE VERSION OF ABOVE
PREFIX oup:<http://oxfordindex.oup.com/metadata/> DELETE {?subj ?pred1 ?link. ?link ?pred2 ?obj.} WHERE {?link a oup:isPrimaryTopicOfLink; oup:hasMatchStatus 'waiting'; ?pred2 ?obj. ?subj ?pred1 ?link}.

PREFIX oup:<http://oxfordindex.oup.com/metadata/> DELETE WHERE {<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306> a oup:Authority; ?pred1 ?obj1. ?obj2 ?pred2 <http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306>. FILTER NOT EXISTS{<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306> oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink.} FILTER NOT EXISTS{<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306> oup:hasLink ?link2. ?link2 a oup:isAuthorOfLink}}.

PREFIX oup:<http://oxfordindex.oup.com/metadata/>
DELETE {<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306> ?pred1 ?obj1. ?obj2 ?pred2 <http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306>}
WHERE
{
	<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306> a oup:Authority;
		?pred1 ?obj1.
	?obj2 ?pred2 <http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306>.
	FILTER NOT EXISTS
	{
		<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306> oup:hasLink ?link1.
		?link1 a oup:isPrimaryTopicOfLink.
	}
	FILTER NOT EXISTS
	{
		<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141008033705155306> oup:hasLink ?link2.
		?link2 a oup:isAuthorOfLink.
	}
}


###############AUTHORITIES WITH AT LEAST 2 PRIMARY TOPIC LINKS
SELECT (count(DISTINCT ?auth) as ?countauth)
WHERE {
 ?auth a oup:Authority;
         oup:hasLink ?link1;
         oup:hasLink ?link2.
 ?link1 a oup:isPrimaryTopicOfLink;
          oup:hasMatchStatus 'approved'.
 ?link2 a oup:isPrimaryTopicOfLink;
          oup:hasMatchStatus 'approved'.
 FILTER (?link1 != ?link2)
}ORDER BY ?auth


################Get Authorities with 3+ isPrimaryTopicOf Links
10.1093/oi/authority.20110803095342715
10.1093/oi/authority.20110803095343523
10.1093/oi/authority.20110803095432721
10.1093/oi/authority.20110803095431849
10.1093/oi/authority.20110803095343215
10.1093/oi/authority.20110803095431799
10.1093/oi/authority.20110803095343129
10.1093/oi/authority.20110803095343127
10.1093/oi/authority.20110803095343104
10.1093/oi/authority.20110803095342719

SELECT DISTINCT?authority
Where{
 ?authority a oup:Authority.
 ?authority oup:hasLink ?link1.
 ?link1 a oup:isPrimaryTopicOfLink.
 ?authority oup:hasLink ?link2.
 ?link2 a oup:isPrimaryTopicOfLink.
 ?authority oup:hasLink ?link3.
 ?link3 a oup:isPrimaryTopicOfLink.
 FILTER (?link1 != ?link2 && ?link1 != ?link3 && ?link2 != ?link3)
} LIMIT 100

Get Records with Multiple PrimaryTopic Links
SELECT (count(?doi) as ?countDOI)
WHERE {
 ?link1 oup:hasTarget ?doi.
 ?link1 a oup:isPrimaryTopicOfLink.
 ?link2 oup:hasTarget ?doi.
 ?link2 a oup:isPrimaryTopicOfLink.
 FILTER (?link1 != ?link2)
}ORDER BY ?link1

SELECT ?doi
WHERE {
  ?link1 oup:hasTarget ?doi.
  ?link1 a oup:isPrimaryTopicOfLink.
  ?link2 oup:hasTarget ?doi.
  ?link2 a oup:isPrimaryTopicOfLink.
  ?link3 oup:hasTarget ?doi.
  ?link3 a oup:isPrimaryTopicOfLink.
  ?link4 oup:hasTarget ?doi.
  ?link4 a oup:isPrimaryTopicOfLink.
  FILTER (?link1 != ?link2 && ?link1 != ?link3 && ?link2 != ?link3 && ?link4 != ?link1 && ?link4 && ?link2 && ?link4 != ?link3)
}

Get PrimaryTopic Target
SELECT ?doi1
where {
 <http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20110803095413160> oup:hasLink ?link1.
 ?link1 a oup:isPrimaryTopicOfLink.
 ?link1 oup:hasTarget ?doi1.
}

Get isRelatedTo Authorities
SELECT ?auth1 ?auth2
WHERE{
  ?auth1 oup:hasLink ?link1.
  ?link1 a oup:isPrimaryTopicOfLink.
  ?link1 oup:hasTarget ?content_record1.
  ?link2 oup:hasTarget ?content_record1.
  ?link2 a oup:referenceLink.
  ?content_record2 oup:hasLink ?link2.
  ?auth2 oup:hasLink ?link3.
  ?link3 a oup:isPrimaryTopicOfLink.
  ?link3 oup:hasTarget ?content_record2.
  FILTER(!sameTerm(?auth1, ?auth2))
}
GROUP BY ?auth1 ?content_record2 ?auth2
HAVING(COUNT(?content_record2) > 2)

SELECT ?auth1 ?auth2
WHERE{
  ?auth1 oup:hasLink ?link1.
  ?link1 a oup:isPrimaryTopicOfLink.
  ?link1 oup:hasTarget ?content_record1.
  ?link2 oup:hasTarget ?content_record1.
  ?link2 a oup:referencesLink.
  ?content_record2 oup:hasLink ?link2.
  ?auth2 oup:hasLink ?link3.
  ?link3 a oup:isPrimaryTopicOfLink.
  ?link3 oup:hasTarget ?content_record2.
  FILTER(!sameTerm(?auth1, ?auth2))
}
GROUP BY ?auth1 ?content_record2 ?auth2
HAVING(COUNT(?content_record2) > 2)

USING PROPERTY PATHS

SELECT ?auth1 ?auth2
WHERE{
  ?auth1 oup:hasLink ?link1.
  ?link1 a oup:isPrimaryTopicOfLink.
  ?link1 oup:hasTarget ?CR1.
  ?CR1 ^oup:hasTarget ?link2, ?link3.
  ?link2 a oup:referencesLink.
  ?link3 a oup:referencesLink.
  filter(!sameTerm(?link2, ?link3))
  ?link2 ^oup:hasLink ?CR2.
  ?link3 ^oup:hasLink ?CR3.
  ?CR2 ^oup:hasTarget ?auth2.
  ?CR3 ^oup:hasTarget ?auth2.
  filter(sameTerm(?auth2, ?auth2))



?link2 oup:hasTarget ?content_record1.
  ?link2 a oup:referencesLink.
  ?content_record2 oup:hasLink ?link2.
  ?auth2 oup:hasLink ?link3.
  ?link3 a oup:isPrimaryTopicOfLink.
  ?link3 oup:hasTarget ?content_record2.
  FILTER(!sameTerm(?auth1, ?auth2))
}
GROUP BY ?auth1 ?content_record2 ?auth2
HAVING(COUNT(?content_record1) > 2)

*WORKS

PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX dc-term:<http://purl.org/dc/terms/>
PREFIX rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX dc:<http://purl.org/dc/elements/1.1/>
PREFIX foaf:<http://xmlns.com/foaf/0.1/>
PREFIX xsd:<http://www.w3.org/2001/XMLSchema#>
PREFIX owl:<http://www.w3.org/2002/07/owl#>
PREFIX oup:<http://oxfordindex.oup.com/metadata/>
SELECT DISTINCT ?auth1 ?auth2 WHERE {
	?auth1 oup:hasLink ?link1, ?link2.
	?link1 a oup:isPrimaryTopicOfLink.
	?link2 a oup:isPrimaryTopicOfLink.
	FILTER (!sameTerm(?link1, ?link2))
	?link1 oup:hasTarget ?CR1.
  	?CR1 (^oup:hasTarget) ?link3, ?link4.
  	?link3 a oup:referencesLink.
  	?link4 a oup:referencesLink.
 	FILTER (!sameTerm(?link3, ?link4))
  	?link3 (^oup:hasLink) ?CR2.
 	?link4 (^oup:hasLink) ?CR3.
	FILTER (!sameTerm(?CR2, ?CR3))
	?auth2 oup:hasLink ?link5, ?link6.
	?link5 a oup:isPrimaryTopicOfLink.
	?link6 a oup:isPrimaryTopicOfLink.
  	?link5 oup:hasTarget ?CR2.
  	?link6 oup:hasTarget ?CR3.
}
OFFSET 10
LIMIT 10





<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141126115729848843~isPrimaryTopicOf~10.1093/gmo/9781561592630.article.26528>

PREFIX oup:<http://oxfordindex.oup.com/metadata/>
DELETE
WHERE
{
	?link a oup:isPrimaryTopicOfLink;
		oup:hasMatchStatus 'waiting';
		?pred2 ?obj.
	?subj ?pred1 ?link
}.

PREFIX oup:<http://oxfordindex.oup.com/metadata/> DELETE WHERE {<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141126115729848843~isPrimaryTopicOf~10.1093/gmo/9781561592630.article.26528> a oup:isPrimaryTopicOfLink; oup:hasMatchStatus 'waiting'; ?pred2 ?obj.?subj ?pred1 <http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20141126115729848843~isPrimaryTopicOf~10.1093/gmo/9781561592630.article.26528>}.

DELETE {?subj ?pred1 ?link. ?link ?pred2 ?obj}
WHERE
{
?link a oup:isPrimaryTopicOfLink;
        oup:hasMatchStatus 'waiting';
       ?pred2 ?obj.
?subj ?pred1 ?link.
}

******************************************************************************************************************
RELATED AUTHS

PREFIX oup:<http://oxfordindex.oup.com/metadata/> DELETE {?subj ?pred1 ?link. ?link ?pred2 ?obj.} WHERE {?link a oup:isPrimaryTopicOfLink; oup:hasMatchStatus 'waiting'; ?pred2 ?obj. ?subj ?pred1 ?link}.


PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT ?link WHERE {?link a oup:isPrimaryTopicOfLink; oup:hasMatchStatus 'waiting'}.



SELECT ?auth1 ?authMatch1 (SAMPLE(?crPrim1) AS ?cr1) (SAMPLE(?crRef1) AS ?crR1) (SAMPLE(?crRef2) AS ?crR2) (SAMPLE(?crPrim2) AS ?cr2)
WHERE {
   {
      SELECT ?auth1 (COUNT(DISTINCT ?link1) AS ?count)
      WHERE {
         ?auth1 a oup:Authority.
         ?auth1 oup:hasLink ?link1.
         ?link1 a oup:isPrimaryTopicOfLink.
         ?link1 oup:hasMatchStatus "approved".
      }
      GROUP BY ?auth1
      HAVING (COUNT(DISTINCT ?link1) > 2)
   }
   ?auth1 oup:hasLink ?prim1.
   ?auth1 oup:hasLink ?prim2.
   ?prim1 a oup:isPrimaryTopicOfLink.
   ?prim1 oup:hasMatchStatus "approved".
   ?prim1 oup:hasTarget ?crPrim1.
   ?prim2 a oup:isPrimaryTopicOfLink.
   ?prim2 oup:hasMatchStatus "approved".
   ?prim2 oup:hasTarget ?crPrim2.
   FILTER (!sameTerm(?prim1, ?prim2))

   ?crPrim1 oup:hasLink ?refLink1.
   ?refLink1 a oup:referencesLink.
   ?refLink1 oup:hasTarget ?crRef1.
   ?crPrim2 oup:hasLink ?refLink2.
   ?refLink2 a oup:referencesLink.
   ?refLink2 oup:hasTarget ?crRef2.
   FILTER (!sameTerm(?crRef1, ?crRef2))

   ?crRef1 (^oup:hasTarget) ?refPrim1.
   ?refPrim1 a oup:isPrimaryTopicOfLink.
   ?refPrim1 oup:hasMatchStatus "approved".
   ?refPrim1 (^oup:hasLink) ?authMatch1.
   ?crRef2 (^oup:hasTarget) ?refPrim2.
   ?refPrim2 a oup:isPrimaryTopicOfLink.
   ?refPrim2 oup:hasMatchStatus "approved".
   ?refPrim2 (^oup:hasLink) ?authMatch1.

   FILTER (!sameTerm(?auth1, ?authMatch1))
   FILTER NOT EXISTS{
            ?auth1 oup:hasLink ?related1.
            ?related1 a oup:isRelatedToLink.
            ?related1 oup:hasTarget ?authMatch1.
   }
         FILTER NOT EXISTS{
            ?authMatch1 oup:hasLink ?related2.
            ?related2 a oup:isRelatedToLink.
            ?related2 oup:hasTarget ?auth1.
   }
}
GROUP BY ?auth1 ?authMatch1
LIMIT 500

OPENRDF VERSION OF ABOVE
PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT ?auth1 ?authMatch1 WHERE { { SELECT ?auth1 (COUNT(DISTINCT ?link1) AS ?count) WHERE { ?auth1 a oup:Authority. ?auth1 oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink. ?link1 oup:hasMatchStatus "approved". } GROUP BY ?auth1 HAVING (COUNT(DISTINCT ?link1) > 2) } ?auth1 oup:hasLink ?prim1. ?auth1 oup:hasLink ?prim2. ?prim1 a oup:isPrimaryTopicOfLink. ?prim1 oup:hasMatchStatus "approved". ?prim1 oup:hasTarget ?crPrim1. ?prim2 a oup:isPrimaryTopicOfLink. ?prim2 oup:hasMatchStatus "approved". ?prim2 oup:hasTarget ?crPrim2. FILTER (!sameTerm(?prim1, ?prim2)) ?crPrim1 oup:hasLink ?refLink1. ?refLink1 a oup:referencesLink. ?refLink1 oup:hasTarget ?crRef1. ?crPrim2 oup:hasLink ?refLink2. ?refLink2 a oup:referencesLink. ?refLink2 oup:hasTarget ?crRef2. FILTER (!sameTerm(?crRef1, ?crRef2)) ?crRef1 (^oup:hasTarget) ?refPrim1. ?refPrim1 a oup:isPrimaryTopicOfLink. ?refPrim1 oup:hasMatchStatus "approved". ?refPrim1 (^oup:hasLink) ?authMatch1. ?crRef2 (^oup:hasTarget) ?refPrim2. ?refPrim2 a oup:isPrimaryTopicOfLink. ?refPrim2 oup:hasMatchStatus "approved". ?refPrim2 (^oup:hasLink) ?authMatch1. FILTER (!sameTerm(?auth1, ?authMatch1)) FILTER NOT EXISTS{ ?auth1 oup:hasLink ?related1. ?related1 a oup:isRelatedToLink. ?related1 oup:hasTarget ?authMatch1. }  FILTER NOT EXISTS{ ?authMatch1 oup:hasLink ?related2. ?related2 a oup:isRelatedToLink.  ?related2 oup:hasTarget ?auth1.  } } GROUP BY ?auth1 ?authMatch1 LIMIT 500.

RELATED AUTHORITIES USING 3 RECORD MATCHES
SELECT ?auth1 ?authMatch1
WHERE {
   {
      SELECT ?auth1 (COUNT(DISTINCT ?link1) AS ?count)
      WHERE {
         ?auth1 a oup:Authority.
         ?auth1 oup:hasLink ?link1.
         ?link1 a oup:isPrimaryTopicOfLink.
         ?link1 oup:hasMatchStatus "approved".
      }
      GROUP BY ?auth1
      HAVING (COUNT(DISTINCT ?link1) > 2)
   }
   ?auth1 oup:hasLink ?prim1.
   ?auth1 oup:hasLink ?prim2.
   ?auth1 oup:hasLink ?prim3.
   ?prim1 a oup:isPrimaryTopicOfLink.
   ?prim1 oup:hasMatchStatus "approved".
   ?prim1 oup:hasTarget ?crPrim1.
   ?prim2 a oup:isPrimaryTopicOfLink.
   ?prim2 oup:hasMatchStatus "approved".
   ?prim2 oup:hasTarget ?crPrim2.
   ?prim3 a oup:isPrimaryTopicOfLink.
   ?prim3 oup:hasMatchStatus "approved".
   ?prim3 oup:hasTarget ?crPrim3.
   FILTER (!sameTerm(?prim1, ?prim2))
   FILTER (!sameTerm(?prim1, ?prim3))
   FILTER (!sameTerm(?prim2, ?prim3))

   ?crPrim1 oup:hasLink ?refLink1.
   ?refLink1 a oup:referencesLink.
   ?refLink1 oup:hasTarget ?crRef1.
   ?crPrim2 oup:hasLink ?refLink2.
   ?refLink2 a oup:referencesLink.
   ?refLink2 oup:hasTarget ?crRef2.
   ?crPrim3 oup:hasLink ?refLink3.
   ?refLink3 a oup:referencesLink.
   ?refLink3 oup:hasTarget ?crRef3.
   FILTER (!sameTerm(?crRef1, ?crRef2))
   FILTER (!sameTerm(?crRef1, ?crRef3))
   FILTER (!sameTerm(?crRef2, ?crRef3))

   ?crRef1 (^oup:hasTarget) ?refPrim1.
   ?refPrim1 a oup:isPrimaryTopicOfLink.
   ?refPrim1 oup:hasMatchStatus "approved".
   ?refPrim1 (^oup:hasLink) ?authMatch1.
   ?crRef2 (^oup:hasTarget) ?refPrim2.
   ?refPrim2 a oup:isPrimaryTopicOfLink.
   ?refPrim2 oup:hasMatchStatus "approved".
   ?refPrim2 (^oup:hasLink) ?authMatch1.
   ?crRef3 (^oup:hasTarget) ?refPrim3.
   ?refPrim3 a oup:isPrimaryTopicOfLink.
   ?refPrim3 oup:hasMatchStatus "approved".
   ?refPrim3 (^oup:hasLink) ?authMatch1.

   FILTER (!sameTerm(?auth1, ?authMatch1))
   FILTER NOT EXISTS{
            ?auth1 oup:hasLink ?related1.
            ?related1 a oup:isRelatedToLink.
            ?related1 oup:hasTarget ?authMatch1.
   }
         FILTER NOT EXISTS{
            ?authMatch1 oup:hasLink ?related2.
            ?related2 a oup:isRelatedToLink.
            ?related2 oup:hasTarget ?auth1.
   }
}
GROUP BY ?auth1 ?authMatch1
LIMIT 500

PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT ?auth1 ?authMatch1 WHERE { { SELECT ?auth1 (COUNT(DISTINCT ?link1) AS ?count) WHERE { ?auth1 a oup:Authority. ?auth1 oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink. ?link1 oup:hasMatchStatus "approved". } GROUP BY ?auth1 HAVING (COUNT(DISTINCT ?link1) > 2) } ?auth1 oup:hasLink ?prim1. ?auth1 oup:hasLink ?prim2. ?auth1 oup:hasLink ?prim3. ?prim1 a oup:isPrimaryTopicOfLink. ?prim1 oup:hasMatchStatus "approved". ?prim1 oup:hasTarget ?crPrim1. ?prim2 a oup:isPrimaryTopicOfLink. ?prim2 oup:hasMatchStatus "approved". ?prim2 oup:hasTarget ?crPrim2. ?prim3 a oup:isPrimaryTopicOfLink. ?prim3 oup:hasMatchStatus "approved". ?prim3 oup:hasTarget ?crPrim3. FILTER (!sameTerm(?prim1, ?prim2)) FILTER (!sameTerm(?prim1, ?prim3)) FILTER (!sameTerm(?prim2, ?prim3)) ?crPrim1 oup:hasLink ?refLink1. ?refLink1 a oup:referencesLink. ?refLink1 oup:hasTarget ?crRef1. ?crPrim2 oup:hasLink ?refLink2. ?refLink2 a oup:referencesLink. ?refLink2 oup:hasTarget ?crRef2. ?crPrim3 oup:hasLink ?refLink3. ?refLink3 a oup:referencesLink. ?refLink3 oup:hasTarget ?crRef3. FILTER (!sameTerm(?crRef1, ?crRef2)) FILTER (!sameTerm(?crRef1, ?crRef3)) FILTER (!sameTerm(?crRef2, ?crRef3)) ?crRef1 (^oup:hasTarget) ?refPrim1. ?refPrim1 a oup:isPrimaryTopicOfLink. ?refPrim1 oup:hasMatchStatus "approved". ?refPrim1 (^oup:hasLink) ?authMatch1. ?crRef2 (^oup:hasTarget) ?refPrim2. ?refPrim2 a oup:isPrimaryTopicOfLink. ?refPrim2 oup:hasMatchStatus "approved". ?refPrim2 (^oup:hasLink) ?authMatch1. ?crRef3 (^oup:hasTarget) ?refPrim3. ?refPrim3 a oup:isPrimaryTopicOfLink. ?refPrim3 oup:hasMatchStatus "approved". ?refPrim3 (^oup:hasLink) ?authMatch1. FILTER (!sameTerm(?auth1, ?authMatch1)) FILTER NOT EXISTS{ ?auth1 oup:hasLink ?related1. ?related1 a oup:isRelatedToLink. ?related1 oup:hasTarget ?authMatch1. } FILTER NOT EXISTS{ ?authMatch1 oup:hasLink ?related2. ?related2 a oup:isRelatedToLink. ?related2 oup:hasTarget ?auth1. } } GROUP BY ?auth1 ?authMatch1 LIMIT 500.

RELATED AUTHS WITH RECORDS
PREFIX oup: <http://oxfordindex.oup.com/metadata/> SELECT ?auth1 ?authMatch1 (SAMPLE(?crPrim1) AS ?cr1) (SAMPLE(?crRef1) AS ?crR1) (SAMPLE(?crRef2) AS ?crR2) (SAMPLE(?crPrim2) AS ?cr2) WHERE {{SELECT ?auth1 (COUNT(DISTINCT ?link1) AS ?count) WHERE { ?auth1 a oup:Authority. ?auth1 oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink. ?link1 oup:hasMatchStatus "approved". ?link1 oup:hasTarget ?cr.} GROUP BY ?auth1 HAVING (COUNT(DISTINCT ?link1) > 2)} ?auth1 oup:hasLink ?prim1. ?auth1 oup:hasLink ?prim2. ?prim1 a oup:isPrimaryTopicOfLink. ?prim1 oup:hasMatchStatus "approved". ?prim1 oup:hasTarget ?crPrim1. ?prim2 a oup:isPrimaryTopicOfLink. ?prim2 oup:hasMatchStatus "approved". ?prim2 oup:hasTarget ?crPrim2. FILTER (!sameTerm(?prim1, ?prim2)) ?crPrim1 oup:hasLink ?refLink1. ?refLink1 a oup:referencesLink. ?refLink1 oup:hasTarget ?crRef1. ?crPrim2 oup:hasLink ?refLink2. ?refLink2 a oup:referencesLink. ?refLink2 oup:hasTarget ?crRef2. FILTER (!sameTerm(?crRef1, ?crRef2)) ?crRef1 (^oup:hasTarget) ?refPrim1. ?refPrim1 a oup:isPrimaryTopicOfLink. ?refPrim1 oup:hasMatchStatus "approved". ?refPrim1 (^oup:hasLink) ?authMatch1. ?crRef2 (^oup:hasTarget) ?refPrim2. ?refPrim2 a oup:isPrimaryTopicOfLink. ?refPrim2 oup:hasMatchStatus "approved". ?refPrim2 (^oup:hasLink) ?authMatch2. FILTER (sameTerm(?authMatch1, ?authMatch2)) FILTER (!sameTerm(?auth1, ?authMatch1)) FILTER NOT EXISTS{ ?auth1 oup:hasLink ?related1. ?related1 a oup:isRelatedToLink. ?related1 oup:hasTarget ?authMatch1.} FILTER NOT EXISTS{ ?authMatch1 oup:hasLink ?related2. ?related2 a oup:isRelatedToLink. ?related2 oup:hasTarget ?auth1. }} GROUP BY ?auth1 ?authMatch1 LIMIT 500

LATEST
PREFIX  oup:  <http://oxfordindex.oup.com/metadata/>

SELECT  ?auth1 ?authMatch1
WHERE
  { { SELECT  ?auth1 (COUNT(DISTINCT ?link1) AS ?count)
      WHERE
        { ?auth1 a oup:Authority .
          ?auth1 oup:hasLink ?link1 .
          ?link1 a oup:isPrimaryTopicOfLink .
          ?link1 oup:hasMatchStatus "approved"
        }
      GROUP BY ?auth1
      HAVING ( COUNT(DISTINCT ?link1) > 2 )
    }
    ?auth1 oup:hasLink ?prim1 .
    ?auth1 oup:hasLink ?prim2 .
    ?prim1 a oup:isPrimaryTopicOfLink .
    ?prim1 oup:hasMatchStatus "approved" .
    ?prim1 oup:hasTarget ?crPrim1 .
    ?prim2 a oup:isPrimaryTopicOfLink .
    ?prim2 oup:hasMatchStatus "approved" .
    ?prim2 oup:hasTarget ?crPrim2
    FILTER ( ! sameTerm(?prim1, ?prim2) )
    ?crPrim1 oup:hasParentTitle ?parentTitle1 .
    ?crPrim2 oup:hasParentTitle ?parentTitle2
    FILTER ( ( ( ?parentTitle1 != ?parentTitle2 ) && ( ! regex(?parentTitle1, str(?parentTitle2), "i") ) ) && ( ! regex(?parentTitle2, str(?parentTitle1), "i") ) )
    ?crPrim1 oup:hasLink ?refLink1 .
    ?refLink1 a oup:referencesLink .
    ?refLink1 oup:hasTarget ?crRef1 .
    ?crPrim2 oup:hasLink ?refLink2 .
    ?refLink2 a oup:referencesLink .
    ?refLink2 oup:hasTarget ?crRef2
    FILTER ( ! sameTerm(?crRef1, ?crRef2) )
    ?crRef1 oup:hasParentTitle ?parentTitle3 .
    ?crRef2 oup:hasParentTitle ?parentTitle4
    FILTER ( ( ( ?parentTitle3 != ?parentTitle4 ) && ( ! regex(?parentTitle3, str(?parentTitle4), "i") ) ) && ( ! regex(?parentTitle4, str(?parentTitle3), "i") ) )
    ?crRef1 ^oup:hasTarget ?refPrim1 .
    ?refPrim1 a oup:isPrimaryTopicOfLink .
    ?refPrim1 oup:hasMatchStatus "approved" .
    ?refPrim1 ^oup:hasLink ?authMatch1 .
    ?crRef2 ^oup:hasTarget ?refPrim2 .
    ?refPrim2 a oup:isPrimaryTopicOfLink .
    ?refPrim2 oup:hasMatchStatus "approved" .
    ?refPrim2 ^oup:hasLink ?authMatch1
    FILTER ( ! sameTerm(?auth1, ?authMatch1) )
    FILTER NOT EXISTS {?auth1 oup:hasLink ?related1 .
      ?related1 a oup:isRelatedToLink .
      ?related1 oup:hasTarget ?authMatch1
    }
    FILTER NOT EXISTS {?authMatch1 oup:hasLink ?related2 .
      ?related2 a oup:isRelatedToLink .
      ?related2 oup:hasTarget ?auth1
    }
  }
GROUP BY ?auth1 ?authMatch1
LIMIT   500

CONSOLE
PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT ?auth1 ?authMatch1 WHERE {{SELECT ?auth1 (COUNT(DISTINCT ?link1) AS ?count) WHERE {?auth1 a oup:Authority; oup:hasLink ?link1. ?link1 a oup:isPrimaryTopicOfLink; oup:hasMatchStatus "approved".} GROUP BY ?auth1 HAVING (COUNT(DISTINCT ?link1) > 2)} ?auth1 oup:hasLink ?prim1; oup:hasLink ?prim2. ?prim1 a oup:isPrimaryTopicOfLink; oup:hasMatchStatus "approved"; oup:hasTarget ?crPrim1. ?prim2 a oup:isPrimaryTopicOfLink; oup:hasMatchStatus "approved"; oup:hasTarget ?crPrim2. FILTER (!sameTerm(?prim1, ?prim2)) ?crPrim1 oup:hasParentTitle ?parentTitle1. ?crPrim2 oup:hasParentTitle ?parentTitle2. FILTER (?parentTitle1 != ?parentTitle2 && !regex(?parentTitle1, str(?parentTitle2), 'i') && !regex(?parentTitle2, str(?parentTitle1), 'i')) ?crPrim1 oup:hasLink ?refLink1. ?refLink1 a oup:referencesLink; oup:hasTarget ?crRef1. ?crPrim2 oup:hasLink ?refLink2. ?refLink2 a oup:referencesLink; oup:hasTarget ?crRef2. FILTER (!sameTerm(?crRef1, ?crRef2)) ?crRef1 oup:hasParentTitle ?parentTitle3. ?crRef2 oup:hasParentTitle ?parentTitle4. FILTER (?parentTitle3 != ?parentTitle4 && !regex(?parentTitle3, str(?parentTitle4), 'i') && !regex(?parentTitle4, str(?parentTitle3), 'i')) ?crRef1 (^oup:hasTarget) ?refPrim1. ?refPrim1 a oup:isPrimaryTopicOfLink; oup:hasMatchStatus "approved"; (^oup:hasLink) ?authMatch1. ?crRef2 (^oup:hasTarget) ?refPrim2. ?refPrim2 a oup:isPrimaryTopicOfLink; oup:hasMatchStatus "approved"; (^oup:hasLink) ?authMatch1. FILTER (!sameTerm(?auth1, ?authMatch1)) FILTER NOT EXISTS{ ?auth1 oup:hasLink ?related1. ?related1 a oup:isRelatedToLink. ?related1 oup:hasTarget ?authMatch1. } FILTER NOT EXISTS{ ?authMatch1 oup:hasLink ?related2. ?related2 a oup:isRelatedToLink. ?related2 oup:hasTarget ?auth1. }} GROUP BY ?auth1 ?authMatch1 LIMIT 500.


************************************************************************************************************************
DELETE AUTHORITY REF LISTS

SAMPLE
<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20110803100203489~isPrimaryTopicOf~10.1093/acref/9780199738595.013.0254>

PREFIX oup:<http://oxfordindex.oup.com/metadata/> DELETE {<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20110803100203493~isPrimaryTopicOf~10.1093/acref/9780199738595.013.0255> oup:hasRejectedAuthority ?auth} WHERE {<http://oxfordindex.oup.com/metadata/10.1093/oi/authority.20110803100203493~isPrimaryTopicOf~10.1093/acref/9780199738595.013.0255> a oup:isPrimaryTopicOfLink; oup:hasRejectedAuthority ?auth}
WHERE {?link a oup:isPrimaryTopicOfLink;
		oup:hasRejectedAuthority ?auth.
		?auth a oup:Authority}

PREFIX oup:<http://oxfordindex.oup.com/metadata/> DELETE {?link oup:hasRejectedAuthority ?auth} WHERE {?link oup:hasRejectedAuthority ?auth.}

FIND ALL ODNB EXTERNALS

SELECT DISTINCT ?external
WHERE{
  ?record oup:hasProductCode "ODNB";
   ^oup:hasTarget ?same.
  ?same a oup:sameEntityAsLink;
   ^oup:hasLink ?external.
}
LIMIT 1000

SELECT (COUNT(DISTINCT ?same) as ?count)
WHERE{
  ?same a oup:sameEntityAsLink.
  FILTER (!regex(str(?same),"oxfordindex"))
}

REMOVE ODNB SAME ENTITY EXTERNALS

DELETE{
  ?same rdf:type oup:sameEntityAsLink;
    ?pred1 ?obj1.

  ?subj2 ?pred2 ?same.

  ?external ?pred3 ?obj3.
  ?subj4 ?pred4 ?external.
}
WHERE{
  ?same a oup:sameEntityAsLink.
  ?external oup:hasLink ?same.
  FILTER (!regex(str(?same),"oxfordindex"))
}

DELETE{
?same rdf:type oup:sameEntityAsLink;
    ?pred1 ?obj1.

  ?subj2 ?pred2 ?same.

  ?external ?pred3 ?obj3.
  ?subj4 ?pred4 ?external.
}
WHERE{
 ?same a oup:sameEntityAsLink;
    oup:hasTarget ?external;
    ^oup:hasLink ?record.
  ?record oup:hasProductCode "ODNB".
  FILTER (!regex(str(?external),"oxfordindex"))
}

##################################################################################################################################
GET ALL NON BOOK SUBJECTS FOR PRODUCT RECORS

SELECT DISTINCT ?record ?subj1
WHERE{
 ?book oup:hasProductCode 'OXMEDO';
   oup:hasLink ?link;
   oup:hasTaxonomyCode ?booksubject.
 ?link a oup:hasPartLink;
   oup:hasTarget ?record.
 ?record oup:hasTaxonomyCode ?subj1.
}GROUP BY ?record ?subj1

CONSOLE VERSION

PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT DISTINCT ?record ?subj1 WHERE{ ?book oup:hasProductCode 'OXMEDO'; oup:hasLink ?link; oup:hasTaxonomyCode ?booksubject. ?link a oup:hasPartLink; oup:hasTarget ?record. ?record oup:hasTaxonomyCode ?subj1.}GROUP BY ?record ?subj1

GET BOOK SUBJECTS

SELECT DISTINCT ?book (sample(?subj1) as ?subj11) (sample(?subj2) as ?subj22) (sample(?subj3) as ?subj33) (sample(?subj4) as ?subj44) (sample(?subj5) as ?subj55)
WHERE{
 ?book oup:hasProductCode 'OXMEDO';
   oup:hasLink ?link;
   oup:hasTaxonomyCode ?subj1.
 ?link a oup:hasPartLink.
 OPTIONAL{
  ?book oup:hasTaxonomyCode ?subj2;
    oup:hasTaxonomyCode ?subj3;
    oup:hasTaxonomyCode ?subj4;
    oup:hasTaxonomyCode ?subj5.
  FILTER(?subj1 != ?subj2 && ?subj1 != ?subj3 && ?subj1 != ?subj4 && ?subj1 != ?subj5)
  FILTER(?subj2 != ?subj3 && ?subj2 != ?subj4 && ?subj2 != ?subj5)
  FILTER(?subj3 != ?subj4 && ?subj3 != ?subj5)
  FILTER(?subj4 != ?subj5)
 }
}GROUP BY ?book

CONSOLE VERSION

PREFIX oup:<http://oxfordindex.oup.com/metadata/> SELECT DISTINCT ?book (sample(?subj1) as ?subj11) (sample(?subj2) as ?subj22) (sample(?subj3) as ?subj33) (sample(?subj4) as ?subj44) (sample(?subj5) as ?subj55) WHERE{ ?book oup:hasProductCode 'OXMEDO'; oup:hasLink ?link; oup:hasTaxonomyCode ?subj1. ?link a oup:hasPartLink. OPTIONAL{ ?book oup:hasTaxonomyCode ?subj2; oup:hasTaxonomyCode ?subj3; oup:hasTaxonomyCode ?subj4; oup:hasTaxonomyCode ?subj5. FILTER(?subj1 != ?subj2 && ?subj1 != ?subj3 && ?subj1 != ?subj4 && ?subj1 != ?subj5) FILTER(?subj2 != ?subj3 && ?subj2 != ?subj4 && ?subj2 != ?subj5) FILTER(?subj3 != ?subj4 && ?subj3 != ?subj5) FILTER(?subj4 != ?subj5)}}GROUP BY ?book.

DELETED
2024-02-13 (Jo Payne) <http://oxfordindex.oup.com/metadata/10.1093/ref:odnb/74372~sameEntityAs~10.1093/ww/9780199540884.013.U164960>
